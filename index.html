<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>bigscreen-player</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>
    <body>
        <script type="module">
            import { BigscreenPlayer, WindowTypes } from "./dist-local/esm/main.js"

            window.bigscreenPlayer = { playbackStrategy: "msestrategy" }

            const player = BigscreenPlayer()
            const playbackElement = document.createElement("div")

            const DebugController = class {
                constructor() {
                    this.signal = document.createDocumentFragment()
                }

                failover() {
                    this.signal.dispatchEvent(new Event("triggerfailover"))
                }

                reload(seconds) {
                    const event = new Event("triggerreload")
                    const detail = { time: seconds }
                    event.detail = detail
                    this.signal.dispatchEvent(event)
                }
            }

            const controller = new DebugController()

            window.bsp_player = player
            window.debug_controller = controller

            document.body.appendChild(playbackElement)

            playbackElement.style.position = "absolute"
            playbackElement.style.height = "720px"
            playbackElement.style.width = "1280px"

            const windowType = WindowTypes.STATIC
            const enableSubtitles = false

            const minimalData = {
                signal: controller.signal,
                initialPlaybackTime: 30,
                media: {
                    captions: [],
                    type: "application/dash+xml",
                    mimeType: "video/mp4",
                    kind: "video",
                    urls: [
                        {
                            // Content from DASH IF testing assests (used in their reference player)
                            // https://reference.dashif.org/dash.js/v2.9.2/samples/dash-if-reference-player/index.htm
                            url: "https://dash.akamaized.net/akamai/bbb_30fps/bbb_30fps.mpd",
                            cdn: "dash.akamaized.net",
                        },
                    ],
                },
            }

            player.init(playbackElement, minimalData, windowType, enableSubtitles, {
                onSuccess: function () {
                    player.toggleDebug()
                    player.registerPlugin({
                        onErrorHandled: (err) => console.error(err),
                        onManifestLoaded: (manifest) => console.log(manifest),
                    })
                },
                onError: function () {
                    player.toggleDebug()
                    DebugTool.info("Initialisation failed.")
                },
            })
        </script>
    </body>
</html>
