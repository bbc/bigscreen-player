<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding meta -->
    
    
    <meta name="description" content="Simplified media playback for bigscreen devices" />
    
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      playbackstrategy/modifiers/samsungstreaming.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-dark.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <h2><a href="index.html"><img src='bsp-logo.png'/></a></h2><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><ul><li class="menu-li"><a href='https://github.com/bbc/bigscreen-player' class=' menu-link' id='' target='_blank'>Github</a></li><li class="menu-li"><a href='https://www.npmjs.com/package/bigscreen-player' class=' menu-link' id='' target='_blank'>NPM</a></li></ul><div class="accordion collapsed" id="5471090" > <h3 class="accordion-heading">Tutorials<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="tutorial-CDN Failover.html">CDN Failover</a></li><li class="accordion-list" id=""><a href="tutorial-Debugging.html">Debugging</a></li><li class="accordion-list" id=""><a href="tutorial-Design.html">Design</a></li><li class="accordion-list" id=""><a href="tutorial-Events.html">Events</a></li><li class="accordion-list" id=""><a href="tutorial-Getting Started.html">Getting Started</a></li><li class="accordion-list" id=""><a href="tutorial-Mocking Playback.html">Mocking Playback</a></li><li class="accordion-list" id=""><a href="tutorial-Playback Strategies.html">Playback Strategies</a></li><li class="accordion-list" id=""><a href="tutorial-Plugins.html">Plugins</a></li><li class="accordion-list" id=""><a href="tutorial-State Changes.html">State Changes</a></li><li class="accordion-list" id=""><a href="tutorial-Testing.html">Testing</a></li></ul> </div><div class="accordion collapsed" id="4772689" > <h3 class="accordion-heading">Modules<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion collapsed child" id=6988947><div class="accordion-heading child"><a href="module-bigscreenplayer_bigscreenplayer.html">bigscreenplayer/bigscreenplayer</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.canPause">canPause</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.canSeek">canSeek</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.convertEpochMsToVideoTimeSeconds">convertEpochMsToVideoTimeSeconds</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.convertVideoTimeSecondsToEpochMs">convertVideoTimeSecondsToEpochMs</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.getCurrentTime">getCurrentTime</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.getDuration">getDuration</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.getFrameworkVersion">getFrameworkVersion</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.getLiveWindowData">getLiveWindowData</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.getLogLevels">getLogLevels</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.getMediaKind">getMediaKind</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.getPlayerElement">getPlayerElement</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.getSeekableRange">getSeekableRange</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.getWindowType">getWindowType</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.isEnded">isEnded</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.isPaused">isPaused</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.isPlayingAtLiveEdge">isPlayingAtLiveEdge</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.isSubtitlesAvailable">isSubtitlesAvailable</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.isSubtitlesEnabled">isSubtitlesEnabled</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.mock">mock</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.mockJasmine">mockJasmine</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.pause">pause</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.play">play</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.registerForStateChanges">registerForStateChanges</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.registerForSubtitleChanges">registerForSubtitleChanges</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.registerForTimeUpdates">registerForTimeUpdates</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.registerPlugin">registerPlugin</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.setCurrentTime">setCurrentTime</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.setLogLevel">setLogLevel</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.setSubtitlesEnabled">setSubtitlesEnabled</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.setTransportControlsPosition">setTransportControlsPosition</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.toggleDebug">toggleDebug</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.transitions">transitions</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.unmock">unmock</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.unregisterForStateChanges">unregisterForStateChanges</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.unregisterForSubtitleChanges">unregisterForSubtitleChanges</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.unregisterForTimeUpdates">unregisterForTimeUpdates</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#.unregisterPlugin">unregisterPlugin</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#~getLiveSupport">getLiveSupport</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#~init">init</a></li><li data-type='method'><a href="module-bigscreenplayer_bigscreenplayer.html#~tearDown">tearDown</a></li></ul></li></ul> </div><div class="accordion collapsed" id="4488839" > <h3 class="accordion-heading">Global<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="global.html#BigscreenPlayerData">BigscreenPlayerData</a></li><li class="accordion-list" id=""><a href="global.html#hasAttribute">hasAttribute</a></li><li class="accordion-list" id=""><a href="global.html#InitCallbacks">InitCallbacks</a></li><li class="accordion-list" id=""><a href="global.html#MediaUrl">MediaUrl</a></li><li class="accordion-list" id=""><a href="global.html#rgbaToRGB">rgbaToRGB</a></li><li class="accordion-list" id=""><a href="global.html#safeRemoveElement">safeRemoveElement</a></li><li class="accordion-list" id=""><a href="global.html#Time">Time</a></li><li class="accordion-list" id=""><a href="global.html#WindowTypes">WindowTypes</a></li></ul> </div></div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        playbackstrategy/modifiers/samsungstreaming.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @preserve Copyright (c) 2017-present British Broadcasting Corporation. All rights reserved.
 * @license See https://github.com/fmtvp/tal/blob/master/LICENSE for full licence
 */
import MediaPlayerBase from '../modifiers/mediaplayerbase'
import DebugTool from '../../debugger/debugtool'

function SamsungStreaming () {
  let state = MediaPlayerBase.STATE.EMPTY
  let currentPlayer
  let deferSeekingTo = null
  let nextSeekingTo = null
  let postBufferingState = null
  let tryingToPause = false
  let currentTimeKnown = false
  let updatingTime = false
  let lastWindowRanged = false

  let mediaType
  let source
  let mimeType

  let range
  let currentTime

  let eventCallbacks = []
  let eventCallback

  let playerPlugin
  let tvmwPlugin
  let originalSource

  try {
    _registerSamsungPlugins()
  } catch (ignoreErr) { }

  const PlayerEventCodes = {
    CONNECTION_FAILED: 1,
    AUTHENTICATION_FAILED: 2,
    STREAM_NOT_FOUND: 3,
    NETWORK_DISCONNECTED: 4,
    NETWORK_SLOW: 5,
    RENDER_ERROR: 6,
    RENDERING_START: 7,
    RENDERING_COMPLETE: 8,
    STREAM_INFO_READY: 9,
    DECODING_COMPLETE: 10,
    BUFFERING_START: 11,
    BUFFERING_COMPLETE: 12,
    BUFFERING_PROGRESS: 13,
    CURRENT_PLAYBACK_TIME: 14,
    AD_START: 15,
    AD_END: 16,
    RESOLUTION_CHANGED: 17,
    BITRATE_CHANGED: 18,
    SUBTITLE: 19,
    CUSTOM: 20
  }

  const PlayerEmps = {
    Player: 0,
    StreamingPlayer: 1
  }

  /**
  * @constant {Number} Time (in seconds) compared to current time within which seeking has no effect.
  * Jumping to time lower than 3s causes error in PlayFrom60 on HLS live - player jumps to previous chunk.
  * Value set to 4s to be ahead of potential wrong player jumps.
  */
  const CURRENT_TIME_TOLERANCE = 4
  const CLAMP_OFFSET_FROM_END_OF_LIVE_RANGE = 10
  const CLAMP_OFFSET_FROM_START_OF_RANGE = 1.1
  const CLAMP_OFFSET_FROM_END_OF_RANGE = 1.1
  const RANGE_UPDATE_TOLERANCE = 8
  const RANGE_END_TOLERANCE = 100

  function initialiseMedia (type, url, mediaMimeType) {
    if (getState() === MediaPlayerBase.STATE.EMPTY) {
      mediaType = type
      source = url
      mimeType = mediaMimeType
      _registerEventHandlers()
      _toStopped()

      if (_isHlsMimeType()) {
        _openStreamingPlayerPlugin()
        if (_isLiveMedia()) {
          source += '|HLSSLIDING|COMPONENT=HLS'
        } else {
          source += '|COMPONENT=HLS'
        }
      } else {
        _openPlayerPlugin()
      }

      _initPlayer(source)
    } else {
      _toError('Cannot set source unless in the \'' + MediaPlayerBase.STATE.EMPTY + '\' state')
    }
  }

  function resume () {
    postBufferingState = MediaPlayerBase.STATE.PLAYING
    switch (getState()) {
      case MediaPlayerBase.STATE.PLAYING:
        break

      case MediaPlayerBase.STATE.BUFFERING:
        if (tryingToPause) {
          tryingToPause = false
          toPlaying()
        }
        break

      case MediaPlayerBase.STATE.PAUSED:
        playerPlugin.Execute('Resume')
        toPlaying()
        break

      default:
        _toError('Cannot resume while in the \'' + getState() + '\' state')
        break
    }
  }

  function playFrom (seconds) {
    postBufferingState = MediaPlayerBase.STATE.PLAYING
    const seekingTo = range ? _getClampedTimeForPlayFrom(seconds) : seconds

    switch (getState()) {
      case MediaPlayerBase.STATE.BUFFERING:
      // deferSeekingTo = seekingTo;
        nextSeekingTo = seekingTo
        break

      case MediaPlayerBase.STATE.PLAYING:
        _toBuffering()
        if (!currentTimeKnown) {
          deferSeekingTo = seekingTo
        } else if (_isNearToCurrentTime(seekingTo)) {
          toPlaying()
        } else {
          _seekToWithFailureStateTransition(seekingTo)
        }
        break

      case MediaPlayerBase.STATE.PAUSED:
        _toBuffering()
        if (!currentTimeKnown) {
          deferSeekingTo = seekingTo
        } else if (_isNearToCurrentTime(seekingTo)) {
          playerPlugin.Execute('Resume')
          toPlaying()
        } else {
          _seekToWithFailureStateTransition(seekingTo)
          playerPlugin.Execute('Resume')
        }
        break

      case MediaPlayerBase.STATE.COMPLETE:
        playerPlugin.Execute('Stop')
        _initPlayer(source)
        playerPlugin.Execute('StartPlayback', seekingTo)
        _toBuffering()
        break

      default:
        _toError('Cannot playFrom while in the \'' + getState() + '\' state')
        break
    }
  }

  function beginPlayback () {
    postBufferingState = MediaPlayerBase.STATE.PLAYING
    switch (getState()) {
      case MediaPlayerBase.STATE.STOPPED:
        _toBuffering()
        playerPlugin.Execute('StartPlayback')
        break

      default:
        _toError('Cannot beginPlayback while in the \'' + getState() + '\' state')
        break
    }
  }

  function beginPlaybackFrom (seconds) {
    postBufferingState = MediaPlayerBase.STATE.PLAYING
    let seekingTo = getSeekableRange() ? _getClampedTimeForPlayFrom(seconds) : seconds

    // StartPlayback from near start of range causes spoiler defect
    if (seekingTo &lt; CLAMP_OFFSET_FROM_START_OF_RANGE &amp;&amp; _isLiveMedia()) {
      seekingTo = CLAMP_OFFSET_FROM_START_OF_RANGE
    } else {
      seekingTo = parseInt(Math.floor(seekingTo), 10)
    }

    switch (getState()) {
      case MediaPlayerBase.STATE.STOPPED:
        playerPlugin.Execute('StartPlayback', seekingTo)
        _toBuffering()
        break

      default:
        _toError('Cannot beginPlayback while in the \'' + getState() + '\' state')
        break
    }
  }

  function pause () {
    postBufferingState = MediaPlayerBase.STATE.PAUSED
    switch (getState()) {
      case MediaPlayerBase.STATE.BUFFERING:
      case MediaPlayerBase.STATE.PAUSED:
        break

      case MediaPlayerBase.STATE.PLAYING:
        _tryPauseWithStateTransition()
        break

      default:
        _toError('Cannot pause while in the \'' + getState() + '\' state')
        break
    }
  }

  function stop () {
    switch (getState()) {
      case MediaPlayerBase.STATE.STOPPED:
        break

      case MediaPlayerBase.STATE.BUFFERING:
      case MediaPlayerBase.STATE.PLAYING:
      case MediaPlayerBase.STATE.PAUSED:
      case MediaPlayerBase.STATE.COMPLETE:
        _stopPlayer()
        _toStopped()
        break

      default:
        _toError('Cannot stop while in the \'' + getState() + '\' state')
        break
    }
  }

  function reset () {
    switch (getState()) {
      case MediaPlayerBase.STATE.EMPTY:
        break

      case MediaPlayerBase.STATE.STOPPED:
      case MediaPlayerBase.STATE.ERROR:
        _toEmpty()
        break

      default:
        _toError('Cannot reset while in the \'' + getState() + '\' state')
        break
    }
  }

  function getSource () {
    return source
  }

  function getMimeType () {
    return mimeType
  }

  function getCurrentTime () {
    if (getState() === MediaPlayerBase.STATE.STOPPED) {
      return undefined
    } else {
      return currentTime
    }
  }

  function getSeekableRange () {
    switch (getState()) {
      case MediaPlayerBase.STATE.STOPPED:
      case MediaPlayerBase.STATE.ERROR:
        return undefined

      default:
        return range
    }
  }

  function getDuration () {
    if (range) {
      return range.end
    }

    return undefined
  }

  function getState () {
    return state
  }

  function getPlayerElement () {
    return playerPlugin
  }

  function toPlaying () {
    if (_isHlsMimeType() &amp;&amp; _isLiveMedia() &amp;&amp; !updatingTime) {
      _updateRange()
    }

    state = MediaPlayerBase.STATE.PLAYING
    _emitEvent(MediaPlayerBase.EVENT.PLAYING)
  }

  function toPaused () {
    state = MediaPlayerBase.STATE.PAUSED
    _emitEvent(MediaPlayerBase.EVENT.PAUSED)
  }

  function _toStopped () {
    currentTime = 0
    range = undefined
    state = MediaPlayerBase.STATE.STOPPED
    _emitEvent(MediaPlayerBase.EVENT.STOPPED)
  }

  function _toBuffering () {
    state = MediaPlayerBase.STATE.BUFFERING
    _emitEvent(MediaPlayerBase.EVENT.BUFFERING)
  }

  function _toComplete () {
    state = MediaPlayerBase.STATE.COMPLETE
    _emitEvent(MediaPlayerBase.EVENT.COMPLETE)
  }

  function _toEmpty () {
    _wipe()
    state = MediaPlayerBase.STATE.EMPTY
  }

  function _toError (errorMessage) {
    _wipe()
    state = MediaPlayerBase.STATE.ERROR
    _reportError(errorMessage)
    throw new Error('ApiError: ' + errorMessage)
  }

  function _registerSamsungPlugins () {
    playerPlugin = document.getElementById('sefPlayer')
    tvmwPlugin = document.getElementById('pluginObjectTVMW')
    originalSource = tvmwPlugin.GetSource()
    window.addEventListener('hide', () => {
      stop()
      tvmwPlugin.SetSource(originalSource)
    }, false)
  }

  function _getClampedTime (seconds) {
    const range = getSeekableRange()
    const offsetFromEnd = _getClampOffsetFromConfig()
    const nearToEnd = Math.max(range.end - offsetFromEnd, range.start)

    if (seconds &lt; range.start) {
      return range.start
    } else if (seconds > nearToEnd) {
      return nearToEnd
    } else {
      return seconds
    }
  }

  function _openPlayerPlugin () {
    if (currentPlayer !== undefined) {
      playerPlugin.Close()
    }

    playerPlugin.Open('Player', '1.010', 'Player')
    currentPlayer = PlayerEmps.Player
  }

  function _isLiveRangeOutdated () {
    const time = Math.floor(currentTime)

    if (time % 8 === 0 &amp;&amp; !updatingTime &amp;&amp; lastWindowRanged !== time) {
      lastWindowRanged = time
      return true
    } else {
      return false
    }
  }

  function _openStreamingPlayerPlugin () {
    if (currentPlayer !== undefined) {
      playerPlugin.Close()
    }

    playerPlugin.Open('StreamingPlayer', '1.0', 'StreamingPlayer')
    currentPlayer = PlayerEmps.StreamingPlayer
  }

  function _closePlugin () {
    playerPlugin.Close()
    currentPlayer = undefined
  }

  function _initPlayer (source) {
    const result = playerPlugin.Execute('InitPlayer', source)

    if (result !== 1) {
      _toError('Failed to initialize video: ' + source)
    }
  }

  function _onFinishedBuffering () {
    if (getState() !== MediaPlayerBase.STATE.BUFFERING) {
      return
    }

    if (!_isInitialBufferingFinished() &amp;&amp; nextSeekingTo !== null) {
      deferSeekingTo = nextSeekingTo
      nextSeekingTo = null
    }

    if (deferSeekingTo === null) {
      if (postBufferingState === MediaPlayerBase.STATE.PAUSED) {
        _tryPauseWithStateTransition()
      } else {
        toPlaying()
      }
    }
  }

  function _onDeviceError (message) {
    _reportError(message)
  }

  function _onDeviceBuffering () {
    if (getState() === MediaPlayerBase.STATE.PLAYING) {
      _toBuffering()
    }
  }

  function _onEndOfMedia () {
    _toComplete()
  }

  function _stopPlayer () {
    playerPlugin.Execute('Stop')
    currentTimeKnown = false
  }

  function _tryPauseWithStateTransition () {
    let success = playerPlugin.Execute('Pause')
    success = success &amp;&amp; (success !== -1)

    if (success) {
      toPaused()
    }

    tryingToPause = !success
  }

  function _onStatus () {
    const state = getState()

    if (state === MediaPlayerBase.STATE.PLAYING) {
      _emitEvent(MediaPlayerBase.EVENT.STATUS)
    }
  }

  function _updateRange () {
    if (_isHlsMimeType() &amp;&amp; _isLiveMedia()) {
      const playingRange = playerPlugin.Execute('GetPlayingRange').split('-')

      range = {
        start: Math.floor(playingRange[0]),
        end: Math.floor(playingRange[1])
      }

      // don't call range for the next 8 seconds
      updatingTime = true
      setTimeout(() => { updatingTime = false }, RANGE_UPDATE_TOLERANCE * 1000)
    } else {
      const duration = playerPlugin.Execute('GetDuration') / 1000
      range = {
        start: 0,
        end: duration
      }
    }
  }

  function _onCurrentTime (timeInMillis) {
    currentTime = timeInMillis / 1000
    _onStatus()
    currentTimeKnown = true

    // [optimisation] do not call player API periodically in HLS live
    // - calculate range manually when possible
    // - do not calculate range if player API was called less than RANGE_UPDATE_TOLERANCE seconds ago
    if (_isLiveMedia() &amp;&amp; _isLiveRangeOutdated()) {
      range.start += 8
      range.end += 8
    }

    if (nextSeekingTo !== null) {
      deferSeekingTo = nextSeekingTo
      nextSeekingTo = null
    }

    if (deferSeekingTo !== null) {
      _deferredSeek()
    }

    if (tryingToPause) {
      _tryPauseWithStateTransition()
    }
  }

  function _deferredSeek () {
    const clampedTime = _getClampedTimeForPlayFrom(deferSeekingTo)
    const isNearCurrentTime = _isNearToCurrentTime(clampedTime)

    if (isNearCurrentTime) {
      toPlaying()
      deferSeekingTo = null
    } else {
      const seekResult = _seekTo(clampedTime)

      if (seekResult) {
        deferSeekingTo = null
      }
    }
  }

  function _getClampedTimeForPlayFrom (seconds) {
    if (currentPlayer === PlayerEmps.StreamingPlayer &amp;&amp; !updatingTime) {
      _updateRange()
    }

    const clampedTime = _getClampedTime(seconds)

    if (clampedTime !== seconds) {
      DebugTool.info('playFrom ' + seconds + ' clamped to ' + clampedTime + ' - seekable range is { start: ' + range.start + ', end: ' + range.end + ' }')
    }

    return clampedTime
  }

  function _getClampOffsetFromConfig () {
    if (_isLiveMedia()) {
      return CLAMP_OFFSET_FROM_END_OF_LIVE_RANGE
    } else {
      return CLAMP_OFFSET_FROM_END_OF_RANGE
    }
  }

  function _registerEventHandlers () {
    playerPlugin.OnEvent = (eventType, param1) => {
      switch (eventType) {
        case PlayerEventCodes.STREAM_INFO_READY:
          _updateRange()
          break

        case PlayerEventCodes.CURRENT_PLAYBACK_TIME:
          if (range &amp;&amp; _isLiveMedia()) {
            const seconds = Math.floor(param1 / 1000)

            // jump to previous current time if PTS out of range occurs
            if (seconds > range.end + RANGE_END_TOLERANCE) {
              playFrom(currentTime)
              break
              // call GetPlayingRange() on SEF emp if current time is out of range
            } else if (!_isCurrentTimeInRangeTolerance(seconds)) {
              _updateRange()
            }
          }

          _onCurrentTime(param1)
          break

        case PlayerEventCodes.BUFFERING_START:
        case PlayerEventCodes.BUFFERING_PROGRESS:
          _onDeviceBuffering()
          break

        case PlayerEventCodes.BUFFERING_COMPLETE:
          // For live HLS, don't update the range more than once every 8 seconds
          if (!updatingTime) {
            _updateRange()
          }

          // [optimisation] if Stop() is not called after RENDERING_COMPLETE then player sends periodically BUFFERING_COMPLETE and RENDERING_COMPLETE
          // ignore BUFFERING_COMPLETE if player is already in COMPLETE state
          if (getState() !== MediaPlayerBase.STATE.COMPLETE) {
            _onFinishedBuffering()
          }
          break

        case PlayerEventCodes.RENDERING_COMPLETE:
          // [optimisation] if Stop() is not called after RENDERING_COMPLETE then player sends periodically BUFFERING_COMPLETE and RENDERING_COMPLETE
          // ignore RENDERING_COMPLETE if player is already in COMPLETE state
          if (getState() !== MediaPlayerBase.STATE.COMPLETE) {
            _onEndOfMedia()
          }
          break

        case PlayerEventCodes.CONNECTION_FAILED:
          _onDeviceError('Media element emitted OnConnectionFailed')
          break

        case PlayerEventCodes.NETWORK_DISCONNECTED:
          _onDeviceError('Media element emitted OnNetworkDisconnected')
          break

        case PlayerEventCodes.AUTHENTICATION_FAILED:
          _onDeviceError('Media element emitted OnAuthenticationFailed')
          break

        case PlayerEventCodes.RENDER_ERROR:
          _onDeviceError('Media element emitted OnRenderError')
          break

        case PlayerEventCodes.STREAM_NOT_FOUND:
          _onDeviceError('Media element emitted OnStreamNotFound')
          break
      }
    }

    window.addEventListener('hide', _onWindowHide, false)
    window.addEventListener('unload', _onWindowHide, false)
  }

  function _onWindowHide () {
    stop()
  }

  function _unregisterEventHandlers () {
    playerPlugin.OnEvent = undefined
    window.removeEventListener('hide', _onWindowHide, false)
    window.removeEventListener('unload', _onWindowHide, false)
  }

  function _wipe () {
    _stopPlayer()
    _closePlugin()
    _unregisterEventHandlers()

    mediaType = undefined
    source = undefined
    mimeType = undefined
    currentTime = undefined
    range = undefined
    deferSeekingTo = null
    nextSeekingTo = null
    tryingToPause = false
    currentTimeKnown = false
    updatingTime = false
    lastWindowRanged = false
  }

  function _seekTo (seconds) {
    const offset = seconds - getCurrentTime()
    const success = _jump(offset)

    if (success === 1) {
      currentTime = seconds
    }

    return success
  }

  function _seekToWithFailureStateTransition (seconds) {
    const success = _seekTo(seconds)

    if (success !== 1) {
      toPlaying()
    }
  }

  function _jump (offsetSeconds) {
    let result

    if (offsetSeconds > 0) {
      result = playerPlugin.Execute('JumpForward', offsetSeconds)
      return result
    } else {
      result = playerPlugin.Execute('JumpBackward', Math.abs(offsetSeconds))
      return result
    }
  }

  function _isHlsMimeType () {
    const mime = mimeType.toLowerCase()
    return mime === 'application/vnd.apple.mpegurl' || mime === 'application/x-mpegurl'
  }

  function _isCurrentTimeInRangeTolerance (seconds) {
    if (seconds > range.end + RANGE_UPDATE_TOLERANCE) {
      return false
    } else if (seconds &lt; range.start - RANGE_UPDATE_TOLERANCE) {
      return false
    } else {
      return true
    }
  }

  function _isInitialBufferingFinished () {
    if (currentTime === undefined || currentTime === 0) {
      return false
    } else {
      return true
    }
  }

  function _reportError (errorMessage) {
    DebugTool.info(errorMessage)
    _emitEvent(MediaPlayerBase.EVENT.ERROR, {'errorMessage': errorMessage})
  }

  function _isNearToCurrentTime (seconds) {
    const currentTime = getCurrentTime()
    const targetTime = _getClampedTime(seconds)

    return Math.abs(currentTime - targetTime) &lt;= CURRENT_TIME_TOLERANCE
  }

  function _isLiveMedia () {
    return (mediaType === MediaPlayerBase.TYPE.LIVE_VIDEO) || (mediaType === MediaPlayerBase.TYPE.LIVE_AUDIO)
  }

  function _emitEvent (eventType, eventLabels) {
    const event = {
      type: eventType,
      currentTime: getCurrentTime(),
      seekableRange: getSeekableRange(),
      duration: getDuration(),
      url: getSource(),
      mimeType: getMimeType(),
      state: getState()
    }

    if (eventLabels) {
      for (const key in eventLabels) {
        if (eventLabels.hasOwnProperty(key)) {
          event[key] = eventLabels[key]
        }
      }
    }

    for (let index = 0; index &lt; eventCallbacks.length; index++) {
      eventCallbacks[index](event)
    }
  }

  return {
    addEventCallback: (thisArg, newCallback) => {
      eventCallback = (event) => newCallback.call(thisArg, event)
      eventCallbacks.push(eventCallback)
    },

    removeEventCallback: (callback) => {
      const index = eventCallbacks.indexOf(callback)

      if (index !== -1) {
        eventCallbacks.splice(index, 1)
      }
    },

    removeAllEventCallbacks: () => { eventCallbacks = [] },

    initialiseMedia: initialiseMedia,
    playFrom: playFrom,
    beginPlayback: beginPlayback,
    beginPlaybackFrom: beginPlaybackFrom,
    resume: resume,
    pause: pause,
    stop: stop,
    reset: reset,
    getSeekableRange: getSeekableRange,
    getState: getState,
    getPlayerElement: getPlayerElement,
    getSource: getSource,
    getMimeType: getMimeType,
    getCurrentTime: getCurrentTime,
    getDuration: getDuration,
    toPaused: toPaused,
    toPlaying: toPlaying
  }
}

export default SamsungStreaming
</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"CDN Failover","link":"CDN Failover"},{"title":"Debugging","link":"Debugging"},{"title":"Design","link":"Design"},{"title":"Events","link":"Events"},{"title":"Getting Started","link":"Getting Started"},{"title":"Mocking Playback","link":"Mocking Playback"},{"title":"Playback Strategies","link":"Playback Strategies"},{"title":"Plugins","link":"Plugins"},{"title":"State Changes","link":"State Changes"},{"title":"Testing","link":"Testing"},{"title":"bigscreenplayer/bigscreenplayer","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html\">bigscreenplayer/bigscreenplayer</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.canPause","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.canPause\">module:bigscreenplayer/bigscreenplayer.canPause &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.canSeek","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.canSeek\">module:bigscreenplayer/bigscreenplayer.canSeek &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.convertEpochMsToVideoTimeSeconds","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.convertEpochMsToVideoTimeSeconds\">module:bigscreenplayer/bigscreenplayer.convertEpochMsToVideoTimeSeconds &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.convertVideoTimeSecondsToEpochMs","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.convertVideoTimeSecondsToEpochMs\">module:bigscreenplayer/bigscreenplayer.convertVideoTimeSecondsToEpochMs &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.getCurrentTime","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.getCurrentTime\">module:bigscreenplayer/bigscreenplayer.getCurrentTime &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.getDuration","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.getDuration\">module:bigscreenplayer/bigscreenplayer.getDuration &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.getFrameworkVersion","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.getFrameworkVersion\">module:bigscreenplayer/bigscreenplayer.getFrameworkVersion &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.getLiveWindowData","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.getLiveWindowData\">module:bigscreenplayer/bigscreenplayer.getLiveWindowData &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.getLogLevels","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.getLogLevels\">module:bigscreenplayer/bigscreenplayer.getLogLevels &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.getMediaKind","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.getMediaKind\">module:bigscreenplayer/bigscreenplayer.getMediaKind &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.getPlayerElement","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.getPlayerElement\">module:bigscreenplayer/bigscreenplayer.getPlayerElement &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.getSeekableRange","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.getSeekableRange\">module:bigscreenplayer/bigscreenplayer.getSeekableRange &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.getWindowType","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.getWindowType\">module:bigscreenplayer/bigscreenplayer.getWindowType &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.isEnded","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.isEnded\">module:bigscreenplayer/bigscreenplayer.isEnded &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.isPaused","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.isPaused\">module:bigscreenplayer/bigscreenplayer.isPaused &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.isPlayingAtLiveEdge","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.isPlayingAtLiveEdge\">module:bigscreenplayer/bigscreenplayer.isPlayingAtLiveEdge &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.isSubtitlesAvailable","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.isSubtitlesAvailable\">module:bigscreenplayer/bigscreenplayer.isSubtitlesAvailable &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.isSubtitlesEnabled","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.isSubtitlesEnabled\">module:bigscreenplayer/bigscreenplayer.isSubtitlesEnabled &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.mock","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.mock\">module:bigscreenplayer/bigscreenplayer.mock &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.mockJasmine","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.mockJasmine\">module:bigscreenplayer/bigscreenplayer.mockJasmine &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.pause","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.pause\">module:bigscreenplayer/bigscreenplayer.pause &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.play","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.play\">module:bigscreenplayer/bigscreenplayer.play &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.registerForStateChanges","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.registerForStateChanges\">module:bigscreenplayer/bigscreenplayer.registerForStateChanges &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.registerForSubtitleChanges","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.registerForSubtitleChanges\">module:bigscreenplayer/bigscreenplayer.registerForSubtitleChanges &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.registerForTimeUpdates","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.registerForTimeUpdates\">module:bigscreenplayer/bigscreenplayer.registerForTimeUpdates &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.registerPlugin","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.registerPlugin\">module:bigscreenplayer/bigscreenplayer.registerPlugin &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.setCurrentTime","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.setCurrentTime\">module:bigscreenplayer/bigscreenplayer.setCurrentTime &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.setLogLevel","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.setLogLevel\">module:bigscreenplayer/bigscreenplayer.setLogLevel &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.setSubtitlesEnabled","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.setSubtitlesEnabled\">module:bigscreenplayer/bigscreenplayer.setSubtitlesEnabled &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.setTransportControlsPosition","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.setTransportControlsPosition\">module:bigscreenplayer/bigscreenplayer.setTransportControlsPosition &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.toggleDebug","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.toggleDebug\">module:bigscreenplayer/bigscreenplayer.toggleDebug &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.transitions","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.transitions\">module:bigscreenplayer/bigscreenplayer.transitions &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.unmock","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.unmock\">module:bigscreenplayer/bigscreenplayer.unmock &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.unregisterForStateChanges","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.unregisterForStateChanges\">module:bigscreenplayer/bigscreenplayer.unregisterForStateChanges &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.unregisterForSubtitleChanges","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.unregisterForSubtitleChanges\">module:bigscreenplayer/bigscreenplayer.unregisterForSubtitleChanges &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.unregisterForTimeUpdates","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.unregisterForTimeUpdates\">module:bigscreenplayer/bigscreenplayer.unregisterForTimeUpdates &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer.unregisterPlugin","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#.unregisterPlugin\">module:bigscreenplayer/bigscreenplayer.unregisterPlugin &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer~getLiveSupport","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#~getLiveSupport\">module:bigscreenplayer/bigscreenplayer~getLiveSupport &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer~init","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#~init\">module:bigscreenplayer/bigscreenplayer~init &rtrif; undefined</a>"},{"title":"module:bigscreenplayer/bigscreenplayer~tearDown","link":"<a href=\"module-bigscreenplayer_bigscreenplayer.html#~tearDown\">module:bigscreenplayer/bigscreenplayer~tearDown &rtrif; undefined</a>"},{"title":"BigscreenPlayerData","link":"<a href=\"global.html#BigscreenPlayerData\">BigscreenPlayerData</a>"},{"title":"hasAttribute","link":"<a href=\"global.html#hasAttribute\">hasAttribute</a>"},{"title":"InitCallbacks","link":"<a href=\"global.html#InitCallbacks\">InitCallbacks</a>"},{"title":"MediaUrl","link":"<a href=\"global.html#MediaUrl\">MediaUrl</a>"},{"title":"rgbaToRGB","link":"<a href=\"global.html#rgbaToRGB\">rgbaToRGB</a>"},{"title":"safeRemoveElement","link":"<a href=\"global.html#safeRemoveElement\">safeRemoveElement</a>"},{"title":"Time","link":"<a href=\"global.html#Time\">Time</a>"},{"title":"WindowTypes","link":"<a href=\"global.html#WindowTypes\">WindowTypes</a>"}];
        var options = {"shouldSort":true,"threshold":0.4,"location":0,"distance":100,"maxPatternLength":32,"minMatchCharLength":1}
          setupSearch(list, options)
      </script>
    

    

    

    

    


  </body>

</html>
